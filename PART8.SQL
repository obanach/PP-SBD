/*
    ZAD 1
 */
INSERT INTO PRACOWNICY (ID_PRAC, NAZWISKO, ETAT, ID_SZEFA, ZATRUDNIONY, PLACA_POD, PLACA_DOD, ID_ZESP) VALUES
    (250, 'KOWALSKI', 'ASYSTENT', NULL, DATE '2015-01-13', 1500, NULL, 10);
INSERT INTO PRACOWNICY (ID_PRAC, NAZWISKO, ETAT, ID_SZEFA, ZATRUDNIONY, PLACA_POD, PLACA_DOD, ID_ZESP) VALUES
    (260, 'ADAMSKI', 'ASYSTENT', NULL, DATE '2014-09-10', 1500, NULL, 10);
INSERT INTO PRACOWNICY (ID_PRAC, NAZWISKO, ETAT, ID_SZEFA, ZATRUDNIONY, PLACA_POD, PLACA_DOD, ID_ZESP) VALUES
    (270, 'NOWAK', 'ADIUNKT', NULL, DATE '1990-05-01', 2050, 540, 20);

/*
    ZAD 2
 */
UPDATE PRACOWNICY
SET PLACA_POD = PLACA_POD*1.1, PLACA_DOD = COALESCE(PLACA_DOD*1.2, 100)
WHERE ID_PRAC >= 250;

/*
    ZAD 3
 */
INSERT INTO ZESPOLY (ID_ZESP, NAZWA, ADRES) VALUES (60, 'BAZY DANYCH', 'PIOTROWO 2');

/*
    ZAD 4
 */
UPDATE PRACOWNICY P
SET (P.ID_ZESP) = (SELECT ID_ZESP FROM ZESPOLY WHERE NAZWA = 'BAZY DANYCH')
WHERE P.ID_PRAC >= 250;

/*
    ZAD 5
 */
UPDATE PRACOWNICY P
SET (P.ID_SZEFA) = (SELECT ID_PRAC FROM PRACOWNICY WHERE NAZWISKO = 'MORZY')
WHERE P.ID_ZESP = (SELECT ID_ZESP FROM ZESPOLY WHERE NAZWA = 'BAZY DANYCH');

/*
    ZAD 6
 */
DELETE FROM ZESPOLY WHERE NAZWA = 'BAZY DANYCH';

/*
    ZAD 7
 */
DELETE FROM PRACOWNICY WHERE ID_ZESP = (SELECT ID_ZESP FROM ZESPOLY WHERE NAZWA = 'BAZY DANYCH');
DELETE FROM ZESPOLY WHERE NAZWA = 'BAZY DANYCH';

/*
    ZAD 8
 */
SELECT
  P.NAZWISKO,
  P.PLACA_POD,
  (SELECT AVG(PLACA_POD)*0.1
   FROM PRACOWNICY GROUP BY ID_ZESP HAVING ID_ZESP = P.ID_ZESP) AS PODWYZKA
FROM PRACOWNICY P;

/*
    ZAD 9
 */
UPDATE PRACOWNICY P
SET (P.PLACA_POD) = (
    SELECT P.PLACA_POD + 0.1 * AVG(PLACA_POD)
    FROM PRACOWNICY
    GROUP BY ID_ZESP
    HAVING ID_ZESP = P.ID_ZESP
);

/*
    ZAD 10
 */
SELECT *
FROM PRACOWNICY
ORDER BY PLACA_POD ASC
FETCH FIRST 1 ROWS WITH TIES;

/*
    ZAD 11
 */
UPDATE PRACOWNICY P
SET (P.PLACA_POD) = (
    SELECT AVG(PLACA_POD) FROM PRACOWNICY
)
WHERE P.ID_PRAC IN (
    SELECT ID_PRAC
    FROM PRACOWNICY
    ORDER BY PLACA_POD ASC
    FETCH FIRST 1 ROWS WITH TIES
);


/*
    ZAD 12
 */
SELECT NAZWISKO, PLACA_DOD FROM PRACOWNICY WHERE ID_ZESP = 20;

UPDATE PRACOWNICY P
SET (P.PLACA_POD) = (
    SELECT ROUND(AVG(PLACA_POD), 2)
FROM PRACOWNICY
WHERE ID_SZEFA = (SELECT ID_SZEFA FROM PRACOWNICY WHERE NAZWISKO = 'MORZY')
) WHERE P.ID_ZESP = 20;

SELECT NAZWISKO, PLACA_DOD FROM PRACOWNICY WHERE ID_ZESP = 20;


/*
    ZAD 13
 */
UPDATE
     (SELECT NAZWISKO, PLACA_POD FROM PRACOWNICY P JOIN ZESPOLY Z ON P.ID_ZESP = Z.ID_ZESP
WHERE NAZWA = 'SYSTEMY ROZPROSZONE') SET PLACA_POD = 1.25*PLACA_POD;


/*
    ZAD 14
 */
DELETE FROM (SELECT P.NAZWISKO AS PRACOWNIK FROM PRACOWNICY P JOIN PRACOWNICY S ON P.ID_SZEFA = S.ID_PRAC WHERE S.NAZWISKO = 'MORZY');


/*
    ZAD 15
 */
SELECT * FROM PRACOWNICY;


/*
    ZAD 16
 */
create sequence prac_seq start with 300 increment by 10;


/*
    ZAD 17
 */
INSERT INTO PRACOWNICY(ID_PRAC, NAZWISKO, ETAT, PLACA_POD) VALUES (PRAC_SEQ.NEXTVAL, 'TRĄBCZYŃSKI', 'STAZYSTA', 1000);


/*
    ZAD 18
 */
UPDATE PRACOWNICY SET PLACA_DOD = PRAC_SEQ.CURRVAL WHERE NAZWISKO = 'TRĄBCZYŃSKI';

/*
    ZAD 19
 */
DELETE FROM PRACOWNICY WHERE NAZWISKO = 'TRĄBCZYŃSKI';


/*
    ZAD 20
 */
CREATE SEQUENCE MALA_SEQ START WITH 1 INCREMENT BY 10 MAXVALUE 11; 
SELECT MALA_SEQ.CURRVAL FROM DUAL;


/*
    ZAD 21
 */
DROP SEQUENCE MALA_SEQ;


