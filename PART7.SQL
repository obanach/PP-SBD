/*
    ZAD 1
 */
SELECT
    NAZWISKO,
    PLACA_POD
FROM PRACOWNICY ORDER BY PLACA_POD DESC
FETCH FIRST 3 ROWS ONLY;

SELECT
    ROWNUM,
    T.NAZWISKO,
    T.PLACA_POD
FROM (SELECT NAZWISKO, PLACA_POD FROM PRACOWNICY T ORDER BY T.PLACA_POD DESC) T WHERE ROWNUM <= 3;


/*
    ZAD 2
 */
SELECT
    NAZWISKO,
    PLACA_POD
FROM PRACOWNICY ORDER BY PLACA_POD DESC
OFFSET 5 ROWS FETCH NEXT 5 ROWS WITH TIES;

SELECT
    NAZWISKO,
    PLACA_POD
FROM (SELECT ROWNUM AS RANKING, NAZWISKO, PLACA_POD FROM (SELECT NAZWISKO, PLACA_POD FROM PRACOWNICY ORDER BY PLACA_POD DESC) WHERE ROWNUM < 11)
WHERE RANKING > 5 ORDER BY PLACA_POD DESC;


/*
    ZAD 3
 */
WITH RAPORT AS (SELECT ID_ZESP, AVG(PLACA_POD) AS SREDNIA FROM PRACOWNICY JOIN ZESPOLY USING (ID_ZESP) GROUP BY ID_ZESP)
SELECT
    NAZWISKO,
    PLACA_POD,
    PLACA_POD - SREDNIA AS ROZNICA
FROM PRACOWNICY P JOIN RAPORT R USING (ID_ZESP) WHERE PLACA_POD > SREDNIA ORDER BY NAZWISKO;


/*
    ZAD 4
 */
WITH LATA AS(SELECT EXTRACT(YEAR FROM ZATRUDNIONY) AS ROK,COUNT(*) AS LICZBA FROM PRACOWNICY GROUP BY EXTRACT(YEAR FROM ZATRUDNIONY))
SELECT * FROM LATA ORDER BY LICZBA DESC;


/*
    ZAD 5
 */
WITH LATA AS(SELECT EXTRACT(YEAR FROM ZATRUDNIONY) AS ROK, COUNT(*) AS LICZBA FROM PRACOWNICY GROUP BY EXTRACT(YEAR FROM ZATRUDNIONY))
SELECT * FROM LATA WHERE LICZBA = (SELECT MAX(LICZBA) FROM LATA);


/*
    ZAD 6
 */
WITH ASYSTENCI AS (SELECT NAZWISKO, ETAT, ID_ZESP FROM PRACOWNICY WHERE ETAT = 'ASYSTENT'),
PIOTROWO AS (SELECT NAZWA, ADRES, ID_ZESP FROM ZESPOLY WHERE ADRES = 'PIOTROWO 3A')
SELECT NAZWISKO, ETAT, NAZWA, ADRES FROM ASYSTENCI A JOIN PIOTROWO P ON A.ID_ZESP = P.ID_ZESP;


/*
    ZAD 7
 */
WITH ZAROBKI_ZESPOLOW AS
(SELECT ID_ZESP, SUM(PLACA_POD) AS ZAROBKI FROM PRACOWNICY JOIN ZESPOLY USING (ID_ZESP) GROUP BY ID_ZESP),
MAX_ZAROBKI AS (SELECT MAX(ZAROBKI) AS MAXIMUM FROM ZAROBKI_ZESPOLOW) SELECT NAZWA, ZAROBKI AS MAKS_SUMA_PLAC
FROM ZAROBKI_ZESPOLOW JOIN ZESPOLY USING (ID_ZESP),MAX_ZAROBKI WHERE ZAROBKI = MAXIMUM;


/*
    ZAD 8
 */
WITH PODWLADNI (ID_PRAC, ID_SZEFA, NAZWISKO, POZIOM)
AS (SELECT ID_PRAC, ID_SZEFA, NAZWISKO, 1 FROM PRACOWNICY
WHERE NAZWISKO = 'BRZEZINSKI' UNION ALL SELECT P.ID_PRAC, P.ID_SZEFA, P.NAZWISKO, POZIOM+1
FROM PODWLADNI S JOIN PRACOWNICY P ON S.ID_PRAC = P.ID_SZEFA) SEARCH DEPTH FIRST BY NAZWISKO SET HIERARCHIA SELECT NAZWISKO, POZIOM AS POZYCJA_W_HIERARCHII FROM PODWLADNI ORDER BY HIERARCHIA;

SELECT
    NAZWISKO,
    LEVEL AS POZYCJA_W_HIERARCHII
FROM PRACOWNICY CONNECT BY ID_SZEFA = PRIOR ID_PRAC START WITH NAZWISKO = 'BRZEZINSKI'
ORDER SIBLINGS BY NAZWISKO;


/*
    ZAD 9
 */
WITH PODWLADNI(ID_PRAC, ID_SZEFA, NAZWISKO, POZIOM) AS
(SELECT ID_PRAC, ID_SZEFA, NAZWISKO, 1 FROM PRACOWNICY WHERE NAZWISKO = 'BRZEZINSKI' UNION ALL SELECT P.ID_PRAC, P.ID_SZEFA, RPAD(' ', POZIOM+1, ' ') || P.NAZWISKO, POZIOM+1 FROM PODWLADNI S JOIN PRACOWNICY P ON S.ID_PRAC = P.ID_SZEFA)
SEARCH DEPTH FIRST BY NAZWISKO SET HIERARCHIA
SELECT NAZWISKO, POZIOM AS POZYCJA_W_HIERARCHII FROM PODWLADNI ORDER BY HIERARCHIA;

SELECT RPAD(' ', LEVEL -1, ' ') || NAZWISKO AS NAZWISK0, LEVEL AS POZYCJA_W_HIERARCHII FROM PRACOWNICY CONNECT BY ID_SZEFA = PRIOR ID_PRAC START WITH NAZWISKO = 'BRZEZINSKI' ORDER SIBLINGS BY NAZWISKO;
