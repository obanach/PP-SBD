/*
    ZAD 1
 */
CREATE OR REPLACE VIEW ASYSTENCI (
    ID, NAZWISKO, PLACA, STAZ_PRACY
) AS SELECT
    ID_PRAC,
    NAZWISKO,
    PLACA_POD + COALESCE(PLACA_DOD, 0),
    'LAT: ' || EXTRACT(YEAR FROM ZATRUDNIONY) || ' MIESIÄ˜CY: ' || EXTRACT(MONTH FROM ZATRUDNIONY)
FROM PRACOWNICY
WHERE ETAT = 'ASYSTENT';

SELECT * FROM ASYSTENCI ORDER BY NAZWISKO;

/*
    ZAD 2
 */

CREATE OR REPLACE VIEW PLACE (
    ID_ZESP, SREDNIA, MINIMUM, MAXIMUM,FUNDUSZ, L_PENSJI, L_DODATKOW)
    AS SELECT
    Z.ID_ZESP,
    AVG(PLACA_POD),
    MIN(PLACA_POD),
    MAX(PLACA_POD),
    SUM(PLACA_POD) + SUM(PLACA_DOD),
    COUNT(PLACA_POD),
    COUNT(PLACA_DOD)
    FROM PRACOWNICY P JOIN ZESPOLY Z ON P.ID_ZESP = Z.ID_ZESP
GROUP BY Z.ID_ZESP
;

SELECT * FROM PLACE ORDER BY ID_ZESP;

/*
    ZAD 3
 */

SELECT NAZWISKO, PLACA_POD
    FROM PRACOWNICY P JOIN PLACE X ON P.ID_ZESP = X.ID_ZESP
    WHERE P.PLACA_POD < X.SREDNIA
ORDER BY NAZWISKO;

/*
    ZAD 4
 */

CREATE OR REPLACE VIEW PLACE_MINIMALNE AS 
    SELECT ID_PRAC, NAZWISKO, ETAT, PLACA_POD
    FROM PRACOWNICY WHERE PLACA_POD < 700
WITH CHECK OPTION CONSTRAINT CHK_PLACA_POD;

SELECT * FROM PLACE_MINIMALNE ORDER BY NAZWISKO;

/*
    ZAD 5
 */

UPDATE PLACE_MINIMALNE SET PLACA_POD = 800 WHERE NAZWISKO = 'HAPKE';

/*
    ZAD 6
 */

CREATE OR REPLACE VIEW PRAC_SZEF (ID_PRAC, ID_SZEFA, PRACOWNIK, ETAT, SZEF) AS 
    SELECT P.ID_PRAC, P.ID_SZEFA, P.NAZWISKO, P.ETAT, S.NAZWISKO
    FROM PRACOWNICY P JOIN PRACOWNICY S ON P.ID_SZEFA = S.ID_PRAC
;

INSERT INTO PRAC_SZEF (ID_PRAC, ID_SZEFA, PRACOWNIK, ETAT) VALUES (280, 150, 'MORZY', 'ASYSTENT');
UPDATE PRAC_SZEF SET ID_SZEFA = 130 WHERE ID_PRAC = 280;
DELETE FROM PRAC_SZEF WHERE ID_PRAC = 280;

/*
    ZAD 7
 */

CREATE OR REPLACE VIEW ZAROBKI AS 
    SELECT ID_PRAC, ID_SZEFA, NAZWISKO, ETAT, PLACA_POD
    FROM PRACOWNICY P
    WHERE PLACA_POD <= (SELECT PLACA_POD FROM PRACOWNICY WHERE ID_PRAC = P.ID_SZEFA)
WITH CHECK OPTION CONSTRAINT CHK_ZAROBKI
;

UPDATE ZAROBKI SET PLACA_POD = 2000 WHERE NAZWISKO = 'BIALY';
SELECT * FROM ZAROBKI ORDER BY NAZWISKO;

/*
    ZAD 8
 */

SELECT COLUMN_NAME, UPDATABLE, INSERTABLE, DELETABLE
FROM USER_UPDATABLE_COLUMNS
WHERE TABLE_NAME = 'PRAC_SZEF';
